<?xml version="1.0" encoding="UTF-8"?>

<!--suppress SpringPlaceholdersInspection -->
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd">


    <!--
        MESSAGING SUBSCRIBERS
    -->
    <bean name="eventTaskMap" class="com.max.messaging.subscribe.impl.EventTaskMapping">
        <property name="eventTaskMap">
            <map key-type="java.lang.String" value-type="java.lang.String">
                <entry key="LoggedIn" value="LOG_IN"/>
                <entry key="ProspectAdded" value="ADD_PROSPECT"/>
                <entry key="ProspectContacted" value="CONTACT_PROSPECT"/>
                <entry key="VideoWatched" value="WATCH_VIDEO"/>
                <entry key="WhyAdded" value="ADD_WHY"/>
                <entry key="WhyPhotoUploaded" value="UPLOAD_WHY_PHOTO"/>
                <entry key="AutoShipAdded" value="CREATE_AUTOSHIP"/>
            </map>
        </property>
    </bean>
    <bean name="taskSubscriber" class="com.max.messaging.subscribe.impl.TaskSubscriber" init-method="register" destroy-method="doFinalize">
        <property name="topicSettings" ref="userActivityTopicSettings"/>
        <property name="filterString" value="verb = 'LoggedOn' OR verb = 'WhyPhotoUploaded' OR verb = 'NewAssociateSigned' OR verb = 'ProspectAdded' OR verb = 'ProspectContacted' OR verb = 'VideoWatched' OR verb = 'WhyAdded'"/>
        <property name="subscriberName" value="AutoTaskFlowEngine"/>
    </bean>
    <bean name="autoTaskFlowSubscriber" class="com.max.messaging.subscribe.impl.AutoTaskFlowSubscriber" init-method="register" destroy-method="doFinalize">
        <property name="topicSettings" ref="userActivityTopicSettings"/>
        <property name="filterString" value="verb = 'NewAssociate' OR verb = 'TaskCompleted' OR verb = 'ProspectAdded' OR verb = 'ProspectContacted'"/>
        <property name="subscriberName" value="TaskEngine"/>
    </bean>
    <bean name="notificationSubscriber" class="com.max.messaging.subscribe.impl.NotificationSubscriber" init-method="register" destroy-method="doFinalize">
        <property name="mailService" ref="mailService"/>
        <property name="topicSettings" ref="userActivityTopicSettings"/>
        <property name="filterString" value="verb = 'NewAssociate'"/>
        <property name="subscriberName" value="Notifier"/>
    </bean>
    <bean name="webFeedSubscriber" class="com.max.messaging.subscribe.impl.WebFeedSubscriber" init-method="register" destroy-method="doFinalize">
        <property name="topicSettings" ref="userActivityTopicSettings"/>
        <property name="webChannel" value="root"/>
        <property name="subscriberName" value="PubNubPoster"/>
        <property name="publishKey" value="pub-c-02723478-99a6-4f63-9d74-f82e11034f59"/>
        <property name="subscribeKey" value="sub-c-cd455cbc-a4c2-11e3-a0b1-02ee2ddab7fe"/>
    </bean>
    <!-- If there are ever any service that require some global configurable value, those would be injected here -->

    <bean id="userActivityTopicSettings" class="com.max.messaging.TopicSettings">
        <property name="qpidIcf" value="org.wso2.andes.jndi.PropertiesFileInitialContextFactory"/>
        <property name="carbonClientId" value="carbon"/>
        <property name="carbonDefaultHostname" value="localhost"/>
        <property name="carbonDefaultPort" value="5672"/>
        <property name="connectionFactoryName" value="andesConnectionfactory"/>
        <property name="connectionFactoryNamePrefix" value="connectionfactory."/>
        <property name="topicNamePrefix" value="topic."/>
        <property name="topicName" value="FinalTesting"/> <!-- todo -->
        <property name="carbonVirtualHostName" value="carbon"/>
        <property name="userName" value="admin"/>
        <property name="password" value="admin"/>
    </bean>

    <bean name="userActivityTopicPublisher" class="com.max.messaging.publish.TopicPublisher">
        <property name="topicSettings" ref="userActivityTopicSettings"/>
    </bean>
</beans>
